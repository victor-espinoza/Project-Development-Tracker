<table>
  <thead>
    <tr>
      <th>Project Name</th>
      <th>Sprint Name</th>
      <th>Status</th>
      <th>Focus</th>
      <th>Start Date</th>
      <th>Due Date</th>
      <th>Update</th>
      <th>Delete</th>
    </tr>
  </thead>
  <tbody id="sprints-output">
    <!-- Populate table  -->
    <% data.sprints.forEach(item => {%>
      <tr>
        <% for (const project of data.projects) {%>
          <% if (project.project_id === item.project_id) { %>
            <td><%=project.name%></td>
            <% break; %>
          <% } %>
        <% } %>
        <td>
          <form action="/read-sprint" method="GET">
            <div class="input-field">
              <input type="hidden" value="<%=item.sprint_id %>" name="sprint_id"/>
              <input type="submit" value="<%=item.name %>" name="submitData"/>
            </div>
          </form>
        </td>
        <td><%=item.sprint_status%></td>
        <td>
          <form action="/update-sprint-focus" method="POST" id="sprint-focus-form<%=item.sprint_id %>">
            <div class="input-field">
              <input type="hidden" value="<%=item.sprint_id %>" name="sprint_id"/>
              <% if (item.focus_flag > 0) {%>
                <input type="checkbox" name="sprint-focus-check" onclick="onlyOne(this)" value="<%=item.sprint_id %>" checked>
              <%} else { %>
                <input type="checkbox" name="sprint-focus-check" onclick="onlyOne(this)" value="<%=item.sprint_id %>">
              <%} %>
            </div>
          </form>
        </td>
        <td><%=item.start_date%></td>
        <td><%=item.due_date%></td>
        <td>  
          <form action="/update-sprint" method="GET">
            <div class="input-field">
              <input type="hidden" value="<%=item.sprint_id %>" name="sprint_id"/>
              <input type="submit" value="Update Sprint" name="submitData"/>
            </div>
          </form>
        </td>
        <td>  
          <form action="/delete-sprint" method="POST">
            <div class="input-field">
              <input type="hidden" value="<%=item.sprint_id %>" name="sprint_id"/>
              <input type="submit" value="Delete Sprint" name="submitData"/>
            </div>
          </form>
        </td>
      </tr>
    <% }); %>
  </tbody>
</table>




<ul class="no-bullets">
  <!-- Populate table  -->
  <% data.sprints.forEach(item => {%>
      <li>
        <% for (const project of data.projects) {%>
          <% if (project.project_id === item.project_id) { %>
            <div class="input-field">
              <div name="projectId">
                <label for="projectId">Project:</label>
                <%=project.name%>
              </div>
            </div>
            <% break; %>
          <% } %>
        <% } %>

        <div class="input-field">
          <label for="sprintName">Sprint Name:</label>
          <form action="/read-sprint" method="GET">
              <input type="hidden" value="<%=item.sprint_id %>" name="sprint_id"/>
              <input name="sprintName" type="submit" value="<%=item.name %>" name="submitData"/>
          </form>
        </div>
        

        <div class="input-field">
          <div name="status">
            <label for="status">Status:</label>
            <%=item.sprint_status%>
          </div>
        </div>

        <div class="input-field"> 
          <form action="/update-sprint-focus" method="POST" id="sprint-focus-form<%=item.sprint_id %>">
            <label for="sprint-focus-check">Focus:</label>
            <input type="hidden" value="<%=item.sprint_id %>" name="sprint_id"/>
            <% if (item.focus_flag > 0) {%>
              <input type="checkbox" name="sprint-focus-check" onclick="onlyOne(this)" value="<%=item.sprint_id %>" checked>
            <%} else { %>
              <input type="checkbox" name="sprint-focus-check" onclick="onlyOne(this)" value="<%=item.sprint_id %>">
            <%} %>
          </form>
        </div>

        <div class="input-field">
          <div name="startDate">
            <label for="startDate">Start Date:</label>
            <%=item.start_date%>
          </div>
        </div>

        <div class="input-field">
          <div name="dueDate">
            <label for="dueDate">Due Date:</label>
            <%=item.due_date%>
          </div>
        </div>
      </li>

      <li>
        <div class="input-field">
          <label for="newSprintReview">Sprint Review:</label>
          <textarea name="newSprintReview" cols="50" rows="10" placeholder="Enter Sprint Review Info (If Applicable)..."></textarea>
        </div>
        <div class="input-field">
          <label for="newSprintRetrospective">Sprint Retrospective:</label>
          <textarea name="newSprintRetrospective" cols="50" rows="10" placeholder="Enter Sprint Retrospective Info (If Applicable)..."></textarea>
        </div>
        <div class="input-field">
          <br />
          <input type="submit" value="Create Sprint" name="submitData"/>
        </div>
      </li>
    <% }); %>
  </ul>





<script>
  function onlyOne(checkbox) {
    let focusCount = 0;
    let checkboxes = document.getElementsByName('sprint-focus-check');
    checkboxes.forEach((item) => {
        if (item.checked) 
          focusCount++;
    });
    if (focusCount > 0) {
      checkboxes.forEach((item) => {
          // console.log(item.checked);
          if (item !== checkbox) item.checked = false;
      });
      document.getElementById(`sprint-focus-form${checkbox.value}`).submit();
      // checkbox.parentElement.submit();
    } else {
      checkbox.checked = true;
    }
  }
</script>